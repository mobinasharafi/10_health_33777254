<!DOCTYPE html>
<html>
<head>
    <title>Your Personal Health Records</title>
    <link rel="stylesheet" href="/usr/455/css/style.css">
</head>
<body>

 <nav>
    <a href="/usr/455/">Home</a>
    <a href="/usr/455/about">About</a>

    <% if (session && session.userId) { %>
        <a href="/usr/455/records">View My Records</a>
        <a href="/usr/455/profile">Profile</a>
        <a href="/usr/455/vision">Vision Board</a>
        <a href="/usr/455/logout">Logout</a>
    <% } else { %>
        <a href="/usr/455/login">Login</a>
        <a href="/usr/455/register">Register</a>
    <% } %>
 </nav>

    <h1>Your Personal Health Records</h1>

    <a href="/usr/455/records/add">Add New Record</a>
    <br><br>

    <!-- Search bar -->
    <form action="/usr/455/records/search" method="GET">
        <input type="text" name="q" placeholder="Search activity..." required>
        <button type="submit">Search</button>
    </form>

    <br>

    <!-- Sorting dropdown -->
    <form action="/usr/455/records" method="GET">
        <label>Sort by:</label>
        <select name="sort">
            <option value="date_desc">Newest first</option>
            <option value="date_asc">Oldest first</option>
            <option value="duration">Duration</option>
            <option value="calories">Calories burnt</option>
            <option value="activity">Activity (A–Z)</option>
        </select>
        <button type="submit">Sort</button>
    </form>

    <br>

    <ul>
        <% if (records.length === 0) { %>
            <li>No records yet.</li>
        <% } else { %>
            <% records.forEach(record => { %>
                <li>

                    <strong><%= record.activity %></strong>
                    —
                    <%= record.duration %> minutes

                    <% if (record.calories_burnt !== null) { %>
                        — <%= record.calories_burnt %> calories burnt
                    <% } else { %>
                        — calories unknown
                    <% } %>

                    <% if (record.intensity !== null) { %>
                        — Intensity: <%= record.intensity %>/5
                    <% } %>

                    <br>
                    (on <%= record.created_at.toLocaleString() %>)

                    <!-- Edit -->
                    <a href="/usr/455/records/edit/<%= record.id %>">Edit</a>
                    &nbsp;

                    <!-- Delete -->
                    <form action="/usr/455/records/delete/<%= record.id %>?_method=DELETE"
                          method="POST" style="display:inline;">
                        <button type="submit">Delete</button>
                    </form>

                </li>
            <% }) %>
        <% } %>
    </ul>

</body>
</html>
