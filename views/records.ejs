<!DOCTYPE html> 
<html> 
<head>     
    <title>Your Personal Health Records</title>     
    <link rel="stylesheet" href="<%= basePath %>/css/style.css"> 
</head> 
<body>     

    <!-- Navigating based on user session status -->   
    <nav>     
        <a href="<%= basePath %>/">Home</a>     
        <a href="<%= basePath %>/about">About</a>     

        <% if (session && session.userId) { %>         
            <a href="<%= basePath %>/records">View My Records</a>         
            <a href="<%= basePath %>/profile">Profile</a>         
            <a href="<%= basePath %>/vision">Vision Board</a>         
            <a href="<%= basePath %>/logout">Logout</a>     
        <% } else { %>         
            <a href="<%= basePath %>/login">Login</a>         
            <a href="<%= basePath %>/register">Register</a>     
        <% } %>  
    </nav>       

    <h1>Your Personal Health Records</h1>      

    <a href="<%= basePath %>/records/add">Add New Record</a>     
    <br><br>      

    <!-- Search bar -->     
    <form action="<%= basePath %>/records/search" method="GET">         
        <input type="text" name="q" placeholder="Search activity..." required>         
        <button type="submit">Search</button>     
    </form>      

    <br>      

    <!-- Sorting dropdown -->     
    <form action="<%= basePath %>/records" method="GET">         
        <label>Sort by:</label>         
        <select name="sort">             
            <option value="date_desc">Newest first</option>             
            <option value="date_asc">Oldest first</option>             
            <option value="duration">Duration</option>             
            <option value="calories">Calories burnt</option>             
            <option value="activity">Activity (A–Z)</option>         
        </select>         
        <button type="submit">Sort</button>     
    </form>      

    <br>      

    <ul>         
        <% if (records.length === 0) { %>             
            <li>No records yet.</li>         
        <% } else { %>             
            <% records.forEach(record => { %>                 
                <li>                     
                    <strong><%= record.activity %></strong> — <%= record.duration %> minutes                      

                    <% if (record.calories_burnt !== null) { %>                         
                        — <%= record.calories_burnt %> calories burnt                     
                    <% } else { %>                         
                        — calories unknown                     
                    <% } %>                      

                    <% if (record.intensity !== null) { %>                         
                        — Intensity: <%= record.intensity %>/5                     
                    <% } %>                      

                    <br>                     
                    (on <%= record.created_at.toLocaleString() %>)                      

                    <br>
                    <a href="<%= basePath %>/records/edit/<%= record.id %>">Edit</a>
                    &nbsp;                      

                    <form action="<%= basePath %>/records/delete/<%= record.id %>?_method=DELETE"
                          method="POST" style="display:inline;">                         
                        <button type="submit">Delete</button>                     
                    </form>                 
                </li>             
            <% }) %>         
        <% } %>     
    </ul>  

</body> 
</html>
