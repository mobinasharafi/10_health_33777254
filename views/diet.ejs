<!DOCTYPE html> 
<html>
<head>
    <title>Diet & Hydration</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

<nav>
    <a href="/">Home</a>
    <a href="/about">About</a>

    <% if (session && session.userId) { %>
        <a href="/records">View My Records</a>
        <a href="/profile">Profile</a>
        <a href="/vision">Vision Board</a>
        <a href="/diet">Diet</a>
        <a href="/logout">Logout</a>
    <% } else { %>
        <a href="/login">Login</a>
        <a href="/register">Register</a>
    <% } %>
</nav>

<h1>Diet & Hydration</h1>

<p><strong>Today’s hydration total:</strong> <%= todayHydrationTotal %> ml</p>

<a href="/usr/455/diet/add">
    <button>Add Food / Hydration</button>
</a>

<h2>Weekly Overview</h2>

<canvas id="calorieChart" width="400" height="200"></canvas>
<br>
<canvas id="hydrationChart" width="400" height="200"></canvas>

<h2>Recent Food Logs</h2>

<% if (foodLogs.length === 0) { %>
    <p>No food logs yet.</p>
<% } else { %>
    <% foodLogs.forEach(log => { %>
        <div style="margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
            <strong><%= log.meal_type %></strong> — <%= log.food_name %>
            <% if (log.calories !== null) { %>
                — <%= log.calories %> calories
            <% } %>
            <br>
            <small>(<%= log.logged_at %>)</small>
            <% if (log.notes) { %>
                <p><%= log.notes %></p>
            <% } %>

            <form action="/diet/delete-food/<%= log.id %>?_method=DELETE" method="POST">
                <button type="submit">Delete</button>
            </form>
        </div>
    <% }) %>
<% } %>

<h2>Recent Hydration Logs</h2>

<% if (hydrationLogs.length === 0) { %>
    <p>No hydration logs yet.</p>
<% } else { %>
    <% hydrationLogs.forEach(h => { %>
        <div style="margin-bottom: 10px; padding: 10px; border: 1px solid #ddd; border-radius: 8px;">
            <strong><%= h.amount_ml %> ml</strong> — <%= h.logged_at %>

            <form action="/diet/delete-hydration/<%= h.id %>?_method=DELETE" method="POST">
                <button type="submit">Delete</button>
            </form>
        </div>
    <% }) %>
<% } %>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const calorieLabels = <%- JSON.stringify(calorieChartData.map(d => d.day)) %>;
    const calorieValues = <%- JSON.stringify(calorieChartData.map(d => d.total_calories)) %>;

    const hydrationLabels = <%- JSON.stringify(hydrationChartData.map(d => d.day)) %>;
    const hydrationValues = <%- JSON.stringify(hydrationChartData.map(d => d.total_ml)) %>;

    new Chart(document.getElementById('calorieChart'), {
        type: 'line',
        data: {
            labels: calorieLabels,
            datasets: [{
                label: 'Calories per day',
                data: calorieValues,
                tension: 0.2
            }]
        }
    });

    new Chart(document.getElementById('hydrationChart'), {
        type: 'bar',
        data: {
            labels: hydrationLabels,
            datasets: [{
                label: 'Water intake (ml)',
                data: hydrationValues
            }]
        }
    });
</script>

</body>
</html>
